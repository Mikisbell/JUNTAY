# ğŸ¦ Control de Caja - Overview

El **Sistema de Control de Caja** de JUNTAY estÃ¡ diseÃ±ado siguiendo las mejores prÃ¡cticas bancarias profesionales, proporcionando un control total del efectivo con trazabilidad completa.

## ğŸ¯ CaracterÃ­sticas Principales

### âœ… Operaciones BÃ¡sicas
- **Apertura de Caja** - Con desglose detallado por denominaciones
- **Cierre de Caja** - Arqueo automÃ¡tico con cÃ¡lculo de diferencias
- **Cuadre en Tiempo Real** - Saldo actualizado automÃ¡ticamente

### ğŸ”„ Operaciones Avanzadas
- **Transferencias entre Cajas** - Movimiento de efectivo entre cajas operativas
- **ReposiciÃ³n de Efectivo** - Desde caja principal, banco o cuenta corriente
- **Arqueos Intermedios** - Verificaciones durante el dÃ­a

### ğŸ“Š Control y AuditorÃ­a
- **16 Tipos de Movimientos** - ClasificaciÃ³n profesional completa
- **Trazabilidad Total** - Cada movimiento con usuario, fecha y referencia
- **Reportes AutomÃ¡ticos** - ResÃºmenes diarios y arqueos

## ğŸ—ï¸ Arquitectura del Sistema

### JerarquÃ­a de Cajas
```
ğŸ¢ Empresa
â”œâ”€â”€ ğŸ¦ Caja Principal (Nivel 3)
â”‚   â”œâ”€â”€ ğŸ’° Caja Operativa 1 (Nivel 1)
â”‚   â”œâ”€â”€ ğŸ’° Caja Operativa 2 (Nivel 1)
â”‚   â””â”€â”€ ğŸ’° Caja Operativa N (Nivel 1)
â””â”€â”€ ğŸ›ï¸ Cuenta Corriente Banco
```

### Tipos de Movimientos

| Tipo | DescripciÃ³n | Uso |
|------|-------------|-----|
| `apertura` | Apertura de sesiÃ³n | Inicio de turno |
| `cierre` | Cierre de sesiÃ³n | Fin de turno |
| `ingreso_operacion` | Ingreso operativo | Pagos de clientes |
| `egreso_operacion` | Egreso operativo | PrÃ©stamos otorgados |
| `transferencia_entrada` | RecepciÃ³n de transferencia | Entre cajas |
| `transferencia_salida` | EnvÃ­o de transferencia | Entre cajas |
| `reposicion_entrada` | ReposiciÃ³n recibida | Desde caja principal |
| `deposito_banco` | DepÃ³sito al banco | Excedentes |
| `ajuste_positivo` | Ajuste a favor | Correcciones |
| `ajuste_negativo` | Ajuste en contra | Correcciones |

## ğŸ” Seguridad y Validaciones

### Controles AutomÃ¡ticos
- âœ… **Una sesiÃ³n por caja** - Imposible abrir mÃºltiples sesiones
- âœ… **ValidaciÃ³n de saldos** - No permite egresos sin fondos
- âœ… **AutorizaciÃ³n por montos** - LÃ­mites configurables
- âœ… **AuditorÃ­a completa** - Registro de todos los cambios

### PolÃ­ticas de Seguridad
- ğŸ”’ **Row Level Security (RLS)** - Acceso solo a datos autorizados
- ğŸ‘¤ **Control por usuario** - Cada acciÃ³n registra quiÃ©n la realizÃ³
- ğŸ• **Timestamps automÃ¡ticos** - Fecha y hora exacta de cada movimiento
- ğŸ“ **Referencias Ãºnicas** - CÃ³digos automÃ¡ticos para trazabilidad

## ğŸ“± Interfaz de Usuario

### Dashboard Principal
- **Estado en tiempo real** de todas las cajas
- **Saldos actualizados** automÃ¡ticamente
- **Botones dinÃ¡micos** segÃºn el estado de cada caja
- **Resumen del dÃ­a** con totales consolidados

### Operaciones Disponibles

#### Cuando la Caja estÃ¡ Cerrada
- ğŸ”“ **Abrir Caja** - Iniciar nueva sesiÃ³n

#### Cuando la Caja estÃ¡ Abierta
- ğŸ”„ **Transferir** - Enviar efectivo a otra caja
- ğŸ’° **Reponer** - Recibir efectivo de fuentes externas
- ğŸ”’ **Cerrar Caja** - Finalizar sesiÃ³n con arqueo

## ğŸš€ Flujo de Trabajo Diario

### 1. Inicio de Turno (Apertura)
1. **Seleccionar caja** a abrir
2. **Contar efectivo inicial** por denominaciones
3. **Registrar observaciones** si es necesario
4. **Confirmar apertura** - Sistema crea sesiÃ³n automÃ¡ticamente

### 2. Durante el DÃ­a (Operaciones)
- **Registrar ingresos** - Pagos de clientes
- **Registrar egresos** - PrÃ©stamos otorgados
- **Realizar transferencias** - Si es necesario
- **Reponer efectivo** - Cuando se requiera

### 3. Fin de Turno (Cierre)
1. **Contar efectivo final** por denominaciones
2. **Comparar con sistema** - CÃ¡lculo automÃ¡tico de diferencias
3. **Registrar observaciones** sobre diferencias
4. **Confirmar cierre** - Arqueo final guardado

## ğŸ“Š Reportes y MÃ©tricas

### InformaciÃ³n en Tiempo Real
- **Saldo actual** de cada caja
- **Total de ingresos** del dÃ­a
- **Total de egresos** del dÃ­a
- **NÃºmero de movimientos** realizados

### Reportes Disponibles
- ğŸ“‹ **Arqueo de apertura** - Detalle del efectivo inicial
- ğŸ“‹ **Movimientos del dÃ­a** - Lista completa de transacciones
- ğŸ“‹ **Arqueo de cierre** - ComparaciÃ³n sistema vs fÃ­sico
- ğŸ“‹ **Resumen consolidado** - Todas las cajas del dÃ­a

## ğŸ”§ ConfiguraciÃ³n Avanzada

### LÃ­mites por Caja
```sql
-- ConfiguraciÃ³n de lÃ­mites (ejemplo)
INSERT INTO jerarquia_cajas (caja_id, nivel, limite_maximo, limite_minimo) 
VALUES 
  ('caja-01', 1, 20000, 500),  -- Caja operativa
  ('caja-02', 2, 100000, 5000), -- Caja principal
  ('caja-03', 3, 500000, 10000); -- BÃ³veda banco
```

### Tipos de ReposiciÃ³n
- **Caja Principal** - Transferencia interna
- **Cuenta Corriente** - Retiro bancario
- **BÃ³veda del Banco** - Efectivo de bÃ³veda
- **Transferencia Sucursal** - Entre sucursales

## ğŸ†˜ Problemas Comunes

### âŒ "Ya existe una sesiÃ³n abierta"
**Causa:** Intento de abrir caja que ya estÃ¡ abierta
**SoluciÃ³n:** Cerrar la sesiÃ³n actual primero

### âŒ "Saldo insuficiente"
**Causa:** Intento de egreso mayor al saldo disponible
**SoluciÃ³n:** Verificar saldo o realizar reposiciÃ³n

### âŒ "Caja destino debe estar abierta"
**Causa:** Transferencia a caja cerrada
**SoluciÃ³n:** Abrir la caja destino primero

## ğŸ“š GuÃ­as Relacionadas

- [Apertura de Caja](/modules/caja/opening) - Proceso detallado paso a paso
- [Transferencias](/modules/caja/transfers) - CÃ³mo transferir entre cajas
- [ReposiciÃ³n](/modules/caja/replenishment) - Reponer efectivo
- [Cierre y Arqueo](/modules/caja/closing) - Finalizar sesiÃ³n correctamente
