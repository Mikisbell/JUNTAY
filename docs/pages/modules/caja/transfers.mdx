# ğŸ”„ Transferencias entre Cajas

Las **transferencias entre cajas** permiten mover efectivo de manera segura entre diferentes cajas operativas, manteniendo la trazabilidad completa del proceso.

## ğŸ¯ Â¿CuÃ¡ndo usar Transferencias?

### Casos de Uso Comunes
- ğŸ“ˆ **Caja con exceso** necesita enviar efectivo a caja con poco saldo
- ğŸª **Cambio de turno** entre cajeros de diferentes cajas
- ğŸ”„ **Balanceo de cargas** para distribuir efectivo uniformemente
- ğŸ†˜ **Emergencias** cuando una caja se queda sin fondos

### Tipos de Transferencia
- **Operativa** - Transferencias rutinarias del dÃ­a a dÃ­a
- **ReposiciÃ³n** - Para reponer fondos en caja con saldo bajo
- **Ajuste** - Correcciones de saldos entre cajas
- **Emergencia** - Transferencias urgentes fuera de horario

## ğŸš€ Proceso Paso a Paso

### Prerrequisitos
- âœ… **Caja origen** debe estar abierta
- âœ… **Caja destino** debe estar abierta
- âœ… **Saldo suficiente** en caja origen
- âœ… **Usuario autorizado** para realizar transferencias

### Paso 1: Acceder a Transferencias
1. Ve a la **pÃ¡gina de detalle** de la caja origen
2. Haz clic en el botÃ³n **"Transferir"**
3. Se abrirÃ¡ el formulario de transferencia

### Paso 2: Configurar la Transferencia
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ Transferencia de Efectivo        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Caja Origen: CAJA-01 (Abierta)     â”‚
â”‚ Saldo Disponible: S/ 5,250.00      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Caja Destino: [Seleccionar â–¼]      â”‚
â”‚ Tipo: [Operativa â–¼]                â”‚
â”‚ Monto: S/ [_______]                 â”‚
â”‚ Concepto: [________________]        â”‚
â”‚ Observaciones: [_____________]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Paso 3: Validaciones AutomÃ¡ticas
El sistema verifica automÃ¡ticamente:
- ğŸ” **Saldo suficiente** en caja origen
- ğŸ” **Caja destino abierta** y disponible
- ğŸ” **Monto vÃ¡lido** (mayor a 0)
- ğŸ” **LÃ­mites de transferencia** si estÃ¡n configurados

### Paso 4: ConfirmaciÃ³n y Procesamiento
Al confirmar, el sistema:
1. **Crea movimiento de salida** en caja origen
2. **Crea movimiento de entrada** en caja destino
3. **Actualiza saldos** de ambas cajas automÃ¡ticamente
4. **Genera referencia Ãºnica** (ej: `TRANS-1699901234`)
5. **Registra auditorÃ­a** con usuario, fecha y hora

## ğŸ“Š Ejemplo PrÃ¡ctico

### SituaciÃ³n Inicial
```
CAJA-01 (Principal)     CAJA-02 (Operativa)
â”œâ”€ Saldo: S/ 8,500      â”œâ”€ Saldo: S/ 450
â”œâ”€ Estado: Abierta      â”œâ”€ Estado: Abierta
â””â”€ Cajero: Juan P.      â””â”€ Cajero: MarÃ­a G.
```

### Transferencia Realizada
```
Transferir S/ 2,000 de CAJA-01 â†’ CAJA-02
Tipo: ReposiciÃ³n
Concepto: Reponer fondos para operaciones
```

### Resultado Final
```
CAJA-01 (Principal)     CAJA-02 (Operativa)
â”œâ”€ Saldo: S/ 6,500      â”œâ”€ Saldo: S/ 2,450
â”œâ”€ Movimiento: -S/ 2,000 â”œâ”€ Movimiento: +S/ 2,000
â””â”€ Ref: TRANS-1699901234 â””â”€ Ref: TRANS-1699901234
```

## ğŸ” Seguridad y Trazabilidad

### Registro de Movimientos
Cada transferencia genera **dos movimientos** automÃ¡ticamente:

#### Movimiento en Caja Origen (Salida)
```json
{
  "tipo": "transferencia_salida",
  "concepto": "transferencia_entre_cajas",
  "monto": 2000.00,
  "saldo_anterior": 8500.00,
  "saldo_nuevo": 6500.00,
  "descripcion": "Transferencia a CAJA-02. Reponer fondos para operaciones",
  "referencia_codigo": "TRANS-1699901234",
  "usuario_id": "juan.perez@juntay.com",
  "fecha": "2025-11-13T23:17:00Z"
}
```

#### Movimiento en Caja Destino (Entrada)
```json
{
  "tipo": "transferencia_entrada", 
  "concepto": "transferencia_entre_cajas",
  "monto": 2000.00,
  "saldo_anterior": 450.00,
  "saldo_nuevo": 2450.00,
  "descripcion": "Transferencia desde CAJA-01. Reponer fondos para operaciones",
  "referencia_codigo": "TRANS-1699901234",
  "usuario_id": "juan.perez@juntay.com",
  "fecha": "2025-11-13T23:17:00Z"
}
```

### AuditorÃ­a Completa
- ğŸ‘¤ **Usuario que realizÃ³** la transferencia
- ğŸ• **Fecha y hora exacta** del movimiento
- ğŸ”— **Referencia Ãºnica** para vincular ambos movimientos
- ğŸ“ **Observaciones** y motivo de la transferencia
- ğŸ’° **Saldos antes y despuÃ©s** en ambas cajas

## âš ï¸ Validaciones y Restricciones

### Validaciones del Sistema
- âŒ **No se puede transferir** a la misma caja
- âŒ **No se puede transferir** monto mayor al saldo disponible
- âŒ **No se puede transferir** si caja destino estÃ¡ cerrada
- âŒ **No se puede transferir** monto negativo o cero

### LÃ­mites Configurables (Opcional)
```sql
-- Ejemplo de configuraciÃ³n de lÃ­mites
UPDATE jerarquia_cajas 
SET limite_transferencia_diario = 10000,
    requiere_autorizacion_sobre = 5000
WHERE caja_id = 'caja-01';
```

## ğŸ”„ Flujo de Trabajo Recomendado

### 1. PlanificaciÃ³n Diaria
- ğŸ“Š **Revisar saldos** de todas las cajas al inicio del dÃ­a
- ğŸ“ˆ **Identificar necesidades** de transferencia
- ğŸ“‹ **Planificar movimientos** para balancear cargas

### 2. Durante Operaciones
- ğŸ” **Monitorear saldos** constantemente
- âš¡ **Realizar transferencias** cuando sea necesario
- ğŸ“ **Documentar motivos** en observaciones

### 3. Fin del DÃ­a
- ğŸ“Š **Consolidar saldos** finales
- ğŸ”„ **Transferir excedentes** a caja principal
- ğŸ“‹ **Revisar movimientos** del dÃ­a

## ğŸ†˜ Problemas Comunes y Soluciones

### âŒ "Caja destino debe estar abierta"
**Causa:** La caja seleccionada como destino no tiene sesiÃ³n activa
**SoluciÃ³n:** 
1. Ir a la caja destino
2. Realizar apertura de caja
3. Volver a intentar la transferencia

### âŒ "Saldo insuficiente"
**Causa:** El monto a transferir es mayor al saldo disponible
**SoluciÃ³n:**
1. Verificar saldo actual de la caja origen
2. Reducir el monto de transferencia
3. O realizar reposiciÃ³n en caja origen primero

### âŒ "Error al procesar transferencia"
**Causa:** Problema de conectividad o base de datos
**SoluciÃ³n:**
1. Verificar conexiÃ³n a internet
2. Intentar nuevamente en unos segundos
3. Si persiste, contactar soporte tÃ©cnico

## ğŸ“± Interfaz de Usuario

### BotÃ³n de Transferencia
El botÃ³n **"Transferir"** aparece solo cuando:
- âœ… La caja estÃ¡ **abierta**
- âœ… El usuario tiene **permisos** de transferencia
- âœ… Hay **otras cajas disponibles** como destino

### Formulario Intuitivo
- ğŸ¯ **SelecciÃ³n clara** de caja destino
- ğŸ’° **ValidaciÃ³n en tiempo real** del monto
- ğŸ“ **Campos opcionales** para documentaciÃ³n
- âœ… **ConfirmaciÃ³n visual** antes de procesar

### Feedback Inmediato
- âœ… **Mensaje de Ã©xito** al completar transferencia
- ğŸ”„ **ActualizaciÃ³n automÃ¡tica** de saldos
- ğŸ“‹ **RedirecciÃ³n** a pÃ¡gina de detalle actualizada

## ğŸ“š GuÃ­as Relacionadas

- [Control de Caja - Overview](/modules/caja/overview) - VisiÃ³n general del sistema
- [ReposiciÃ³n de Efectivo](/modules/caja/replenishment) - CÃ³mo reponer desde fuentes externas
- [Apertura de Caja](/modules/caja/opening) - Proceso de apertura
- [Cierre y Arqueo](/modules/caja/closing) - Finalizar sesiÃ³n correctamente
